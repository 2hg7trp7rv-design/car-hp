import fs from "fs";
import path from "path";

const repoRoot = process.cwd();
const carsDir = path.join(repoRoot, "data", "articles", "cars");

const updates = {
  "nissan-gtr-r35": {
    summaryLong:
      "R35 GT-Rは、普段の道をそのまま異次元に速くする車種です。中古で満足度を分けるのは、年式や走行距離よりも『温度管理と油脂類の履歴』。タイヤ・ブレーキなど消耗品の単価も高いので、購入費とは別に初年度の整備予算を厚めに組むのが前提です。状態が読める個体に出会えれば、街乗りでもツーリングでも、スーパーカー級の加速を日常で味わえます。",
    add: {
      check:
        "### 見落としがちな履歴チェック\n- オイル交換だけでなく、ミッションとデフのフルード交換履歴があるか\n- タイヤが前後で同銘柄・同程度か。片減りはアライメントや足回りのサイン\n- ブレーキの摩耗とローターの状態。高負荷走行の痕跡はここに出やすい\n- 下回りの擦り傷やアンダーパネルの欠品。使われ方が読めます",
      maintenance:
        "### 走り方で変わるコストの大きいところ\n街乗り中心なら油脂類と消耗品がメインですが、ワインディングや走行会が増えるとタイヤとブレーキが一気に支配的になります。年間コストは走行距離より、熱を入れた回数で跳ねるイメージです。",
      used:
        "### 相場の安さより『基準づくり』\n購入時に完璧を求めるより、まずは信頼できる工場で点検し、交換すべきものを洗い出して基準を作る。これができる個体かどうかが、中古GT-Rの分かれ目です。",
    },
  },
  "toyota-gr-supra-rz": {
    summaryLong:
      "GRスープラ RZは、現代のFRスポーツとして扱いやすく、日常の延長で速さを楽しめる一台です。一方で中身は輸入車的なメンテナンス感覚に近い部分もあり、履歴が曖昧な個体は後からじわじわ効いてきます。中古で選ぶなら、改造よりも『ノーマルに近い整備履歴』と『冷間始動からの音・振動』を優先。過度に安い個体を追うより、基準を作りやすいコンディションを選ぶ方が結果的に得です。",
    add: {
      check:
        "### 試乗で確認したい感触\n- 冷間始動直後のアイドリングと異音。温まった後だけ良い個体は注意\n- 変速のつながりと低速域のギクシャク。違和感は学習だけで片付かないことも\n- 足回りのコツコツ音。段差で鳴るなら消耗を疑う\n- 警告灯やエラー履歴が点検記録に残っているか",
      maintenance:
        "### 維持費は国産スポーツより少しだけ輸入車寄り\n油脂類の種類や作業工賃、部品の手配などで体感が変わります。短期で安く乗るより、良い個体を長めに維持する方が結果的に安定しやすいです。",
      used:
        "### ノーマルに近い車が強い\n吸排気や足回りの変更自体は悪ではありません。ただし、セッティングの意図が読めないなら、純正に近い状態で基準を作ってから手を入れる方が後悔しません。",
    },
  },
  "mazda-rx7-fd3s": {
    summaryLong:
      "FD3S RX-7は、ロータリーならではの軽さとレスポンスで、今でも代わりが見つかりにくい存在です。中古での難しさは『個体差が大きい』こと。圧縮や冷却、改造履歴の読み解きで、当たり外れの差が大きくなります。選ぶ基準は、走行距離よりも整備記録と温度管理。専門ショップに相談できる体制を作れれば、独特の走りの濃さを長く味わえます。",
    add: {
      check:
        "### 現車確認で優先する順番\n- まずは冷却。ラジエーター周りの状態と、ファンがきちんと働くか\n- 次に始動性と吹け上がり。クセは個体差のヒントになります\n- ターボや配管の状態。後付け部品が多いほど、漏れやすいポイントも増える\n- 最後に錆とボディ。ここが崩れていると、直しても戻りません",
      maintenance:
        "### ロータリーは予防整備で差がつく\n壊れてから直すより、温度とオイルの管理で壊さない方が安い。購入後に一度、油脂類とホース類をリセットできる前提で考えると計画が立てやすいです。",
      used:
        "### 安い個体ほど『理由』が複数ある\n相場より安い車は、冷却、始動、錆、改造のどれかではなく、複数が重なっていることも珍しくありません。安さで飛びつくより、疑問が残らない個体を選ぶ方が長い目で得です。",
    },
  },
  "honda-integra-type-r-dc2": {
    summaryLong:
      "DC2 インテグラ タイプRは、NA高回転と軽い車体が生む、前輪駆動の名作です。中古では年式が古く、性能よりも『ボディと足回りの基礎体力』が肝になります。ブッシュ類、ハブ、マウント、冷却系など、消耗と経年が積み重なる箇所は多め。改造車が多いので、修復歴だけでなく、歪みや錆、履歴の透明性まで含めて判断すると失敗しにくい。",
    add: {
      check:
        "### ボディと足回りは最優先\n- ドアの閉まり方やチリの揃い方。軽い歪みは乗り味に出ます\n- 下回りの錆。ジャッキポイント付近は特に確認\n- ハブやベアリングの音。試乗でゴー音が出る個体は要注意\n- マウントやブッシュの劣化。加減速で揺れるなら交換前提です",
      maintenance:
        "### 部品は『純正にこだわり過ぎない』\n純正が手に入りにくい箇所は、信頼できる社外部品で補う発想も現実的です。大事なのは、基礎を整えてからチューニングに進む順番。",
      used:
        "### 速さより素性\nパワーアップ済みの車は魅力的に見えますが、素性が読めないと不安が増えます。最初の一台は、ノーマルに近く、記録簿が揃った個体から始めるのが無難です。",
    },
  },
  "honda-s2000-ap1": {
    summaryLong:
      "S2000(AP1)は、オープンカーの気持ち良さと、ホンダらしい高回転NAを両立した稀なスポーツです。中古で重要なのは、屋根の状態と足回りの消耗、そして『適切なオイル管理』。走行距離が少なくても放置期間が長い個体は、ゴム類と油脂類が弱りがちです。整備の基準を一度作れば、普段の移動がそのまま特別な時間になります。",
    add: {
      check:
        "### オープンカーならではの確認\n- 幌の擦れ、裂け、雨漏り。フロアの湿りは匂いより先に確認\n- 幌骨やラッチの動き。渋いと調整や部品が必要になる\n- 足回りのコツコツ音。路面の荒れで出やすい\n- 試乗では高回転まで一気に回さず、つながりと振動を確認",
      maintenance:
        "### 放置期間が長い車に注意\n走行距離が少なくても、ゴム類や油脂類は時間で劣化します。購入後の最初はリフレッシュ整備に寄せて予算を確保すると安心です。",
      used:
        "### どんな使い方だったかを読む\nサーキット中心か、ツーリング中心か、保管は屋内か。S2000は使われ方が状態に直結するので、オーナーの話と記録の一貫性を重視したいです。",
    },
  },
  "subaru-impreza-wrx-sti-gc8-type-r": {
    summaryLong:
      "GC8 インプレッサ WRX STI タイプRは、ラリーの空気をそのまま公道に持ち込んだような、濃度の高い4WDターボです。中古では競技ユースや改造歴が多く、エンジン以上に『ボディと駆動系の履歴』を重く見た方がいい。冷却・オイル管理が甘い個体は後で出費が増えます。ノーマルに近い状態で、点検記録が読める車を起点にすると、楽しく長く乗れます。",
    add: {
      check:
        "### 競技ユースの痕跡を探す\n- ボディのスポット増しや補強の有無。良し悪しより思想が重要\n- 下回りのヒット跡。ラリー系はここが荒れやすい\n- 変速と駆動系の音。四駆は違和感が出た時の切り分けが大変\n- 冷却系の手当。追加メーターやオイルクーラーの有無も参考",
      maintenance:
        "### 四駆ターボは消耗品の消費が早い\nタイヤ4本、ブレーキ、油脂類。ここは割り切った方が楽です。逆に、基礎が整えば季節や路面を選ばず走れるのは大きな価値。",
      used:
        "### ノーマルに近い個体が少ない\n候補が見つかったら、迷っている間に売れることもあります。決め手は完璧さではなく、疑問点が説明できるかどうか。説明ができない車は、後でも説明できません。",
    },
  },
  "mitsubishi-lancer-evolution-vi-gsr": {
    summaryLong:
      "ランサーエボリューションVI GSRは、四駆ターボの中でも反応が速く、路面を掴む感じが濃い一台です。中古での難所は、過去の走り方が車に残りやすいこと。足回り、駆動系、冷却のメンテ履歴が曖昧だと、購入後にまとめて直すことになります。走行距離より、整備記録と現車の素直さを優先し、まずは『基準の個体』を作るのが近道です。",
    add: {
      check:
        "### 試乗で違和感が出やすいポイント\n- 加速時の息継ぎやノッキング感。燃料系や点火系の手当が必要なことがあります\n- 駆動系の異音。四駆の唸りや振動は放置すると高くつきます\n- 足回りの追従性。跳ねるならダンパーやブッシュが終わっているサイン\n- 水温の安定。渋滞で上がる個体は要注意",
      maintenance:
        "### 予防整備の優先順位\n冷却と油脂類、次に足回り、最後にチューニング。順番を守るだけで、出費の波が穏やかになります。",
      used:
        "### 過度なパワーアップは一旦置く\n中古でまず欲しいのは、素直に走る基礎。パワーは後から足せますが、歪みと疲労は後から消せません。",
    },
  },
  "nissan-skyline-gtr-r34": {
    summaryLong:
      "R34 スカイラインGT-Rは、RB26と四駆システムの組み合わせを、より洗練されたボディにまとめた象徴的な存在です。中古相場は高く、安い理由がはっきり出やすい車種でもあります。改造歴が濃い個体が多いので、修復歴の有無だけでなく、下回りの傷、歪み、熱が入った痕跡、書類の透明性まで総合で判断。『買う予算』より『守る予算』を重視した方が、結局満足度が高い。",
    add: {
      check:
        "### 改造歴の読み方\n- 何が純正で、何が交換されているかを紙で把握できるか\n- ECUや燃料系の変更があるなら、施工店やセッティング情報が追えるか\n- 追加メーターの配線が綺麗か。雑だと電装トラブルの起点になります\n- 下回りの傷とフレームの波打ち。修復歴なしでも荒れている車はあります",
      maintenance:
        "### 部品と工賃の前提を変える\nR34は部品の相場も作業工賃も昔の感覚では見積もれません。購入前に、よく出る整備の見積もりを一度取っておくと、予算の現実が見えます。",
      used:
        "### 相場は高いが、良い個体は安い\n価格が高く見えても、整備履歴と素性が整っている車は、結果的にトータルが安くなりやすい。安い個体を直して追いつくのは難易度が高めです。",
    },
  },
  "nissan-silvia-s15": {
    summaryLong:
      "S15 シルビアは、軽さとFRらしい素直さが魅力で、今も走り好きに選ばれ続ける車種です。中古ではドリフトや改造歴が多く、見た目以上に『骨格と足回りの状態』で差が出ます。安い個体を拾って直すより、歪みのないボディと、きちんと整備されたエンジンを優先した方が結果的に安い。ノーマル近い個体を起点に、必要な範囲だけ手を入れる方が楽しみやすいです。",
    add: {
      check:
        "### ドリフト歴の見分け方\n- タイヤの内外減りや、アーム類の変更。セッティングが極端な車は癖が出ます\n- リア周りの異音や振動。デフとドラシャの疲労が出やすい\n- ボディのチリとドアの閉まり。軽い歪みでもFRは素直さが落ちます\n- 配線の後付け。追加メーターや点火系の取り回しを確認",
      maintenance:
        "### 走るより先にリフレッシュ\nブッシュ、マウント、冷却、油脂類。ここを整えるだけで、同じS15でも別の車に感じることがあります。",
      used:
        "### 目的を先に決める\n街乗りで軽快に楽しむのか、サーキットを見据えるのか。目的が曖昧だと、車の選び方も整備もブレて費用が増えます。",
    },
  },
  "toyota-supra-jza80-rz": {
    summaryLong:
      "JZA80 スープラ RZは、2JZの余裕と大きめのボディが生む高速域の安定感が魅力です。中古では相場が広く、改造歴も多いので、年式や距離より『何がどこまで手が入っているか』の読み解きが重要。冷却や燃料系、足回りの基礎が崩れている個体は、後から立て直すのに時間と費用が掛かります。まずは素性が分かる一台を選ぶと、結果的に遠回りしません。",
    add: {
      check:
        "### チューニング個体の注意点\n- 過給圧や燃料系に手が入っているなら、セッティングの履歴があるか\n- 排気温や水温の管理がされているか。追加メーターの有無だけでなく設置の質も見る\n- 変速のフィーリング。ATでもMTでも、違和感は早めに拾う\n- 車重があるのでブレーキと足回りの状態はシビアに確認",
      maintenance:
        "### 予算は『大物が来る前提』で\n年式的に、ゴム類と冷却、足回りのリフレッシュは避けられません。買ってから慌てるより、最初の一年で一度整える計画を組むと楽です。",
      used:
        "### ノーマル然としたチューニングが強い\n見た目が派手な車より、基礎が整っていて必要な箇所だけアップデートされている車が扱いやすい。書類と現車の整合性が取れているかを重視したいです。",
    },
  },
  "nissan-z-rz34": {
    summaryLong:
      "フェアレディZ(RZ34)は、現代のスポーツカーとして素直で、日常の範囲でもパワーを使い切れないくらい余裕があります。中古で見るべきは、走行距離よりも『熱の入り方』と『慣らし・油脂類の扱い』。短距離ばかりの個体はコンディションが出やすいので、履歴が読める車を優先すると安心です。維持費は一般車より上がる前提ですが、基準さえ作れば長く乗れます。",
    add: {
      check:
        "### 熱の使われ方を読む\n- 走行会や高負荷走行の痕跡。タイヤとブレーキの減り方がヒントになります\n- 冷間時の異音、温間時の油温。短距離ばかりの車は調子を落としがち\n- 内装の擦れ。走行距離より使われ方の方が出やすい\n- 下回りの擦り。段差で当てているとアライメントが狂うことがあります",
      maintenance:
        "### 走りを楽しむなら消耗品は前提\nスポーツタイヤとブレーキは、楽しさの一部として割り切る。逆にここをケチると、車の良さが出ません。",
      used:
        "### 最初の整備で基準を作る\n納車後に油脂類と消耗品を一度揃えておくと、その後の変化に気づきやすくなります。中古スポーツはこの基準づくりが効きます。",
    },
  },
  "suzuki-alto-works-ha36s": {
    summaryLong:
      "アルトワークス(HA36S)は、維持費を抑えつつ、軽快さとターボの楽しさを味わえる実用系スポーツです。中古は改造車も多いですが、ポイントさえ押さえれば当たりを引きやすい。チェックすべきは足回りのガタ、冷却、オイル管理、そして過去の使われ方。通勤メインの素直な個体を基準にすると、街でもワインディングでも気持ち良く走れます。",
    add: {
      check:
        "### 改造の有無は『質』で判断\n- 足回りのローダウン量が極端だと、乗り心地と寿命が両方落ちます\n- ブーストアップ車は燃料系と点火系の手当が追えるか\n- クラッチのつながり。渋い個体は交換前提\n- 下回りの擦り。軽でも当てると真っ直ぐ走らなくなります",
      maintenance:
        "### 維持費が安い分、リセット整備がしやすい\nタイヤ、ブレーキ、油脂類を早めに揃えて基準を作ると、その後の故障が減ります。安さを武器に『先手』が打てる車です。",
      used:
        "### 通勤個体が狙い目になりやすい\n過度に弄られていない、素直な使われ方の車は当たりが多い。走りを足すのは後からでも間に合います。",
    },
  },
  "suzuki-cappuccino-ea11r": {
    summaryLong:
      "カプチーノ(EA11R)は、軽自動車サイズとは思えないほど、ステアリングと車体の反応がダイレクトなオープンスポーツです。中古では何よりも錆とボディの状態が最優先。距離が少なくても、保管環境で差が出ます。ターボや冷却、ゴム類の劣化も避けられないので、購入後に一度リセット整備する前提で考えると気持ちが楽。軽い車体を生かした走りを求めるなら、今でも強い選択肢です。",
    add: {
      check:
        "### 錆チェックは場所を決めて見る\n- フロアとサイドシル、特にジャッキポイント周辺\n- トランク床やスペアタイヤ周りの湿り\n- ドア下やフェンダー内側の塗装の浮き\n- 幌やウェザーストリップの劣化。雨漏りは錆を加速させます",
      maintenance:
        "### 小さな不具合を放置しない\n軽い異音や水温のブレを放っておくと、部品点数が少ない車ほど一気に悪化します。早めに直す方が安い、典型的なタイプです。",
      used:
        "### 迷ったらボディ優先\n機関は後から直せても、錆と歪みは戻りません。同じ価格なら、距離よりボディが綺麗な方を選ぶ価値があります。",
    },
  },
  "honda-beat-pp1": {
    summaryLong:
      "ビート(PP1)は、軽規格の中にミッドシップを入れた異色作で、速度より『気持ち良さ』が価値になる一台です。中古では年式が古く、機関よりもボディと内装、幌の状態がコンディションを左右します。冷却や燃料系、ゴム類も経年で弱りやすいので、履歴が読める車を選び、購入後に基準整備を入れるのが前提。うまく当たると、毎回の移動がイベントになります。",
    add: {
      check:
        "### ミッドシップ軽のチェックポイント\n- 冷却水の状態と、渋滞時の水温の安定\n- 幌の状態と雨漏り。フロアの湿りは必ず確認\n- シフトの入り。リンク機構のガタが出ると気持ち良さが落ちます\n- 内装の欠品。小物が揃っているかで扱われ方が分かる",
      maintenance:
        "### 予防整備は『ゴム類』から\nホース、ブッシュ、マウント。ここを整えると、走りも乗り心地も一段上がります。年式の古い軽スポーツは、この順番が効きます。",
      used:
        "### 乗り味は個体差が大きい\n同じビートでも、足回りのリフレッシュ具合で別物に感じます。試乗できるなら、段差と旋回での反応を必ず確認したいです。",
    },
  },
  "autozam-az-1-pg6sa": {
    summaryLong:
      "AZ-1(PG6SA)は、軽の枠にミッドシップとガルウィングを詰め込んだ、ほぼ企画勝ちの車種です。中古では希少性ゆえに『選べる個体が少ない』のが最大の難所。だからこそ、錆、雨漏り、ヒンジ周り、内装の欠品など、現車での確認が大切です。機関は軽の延長で整備できますが、外装部品の確保が難しいケースもある。状態が良い個体に出会えれば、所有体験は唯一無二です。",
    add: {
      check:
        "### AZ-1はボディチェックが主役\n- ドアヒンジと開閉のスムーズさ。ガタがあると修理が大変です\n- 雨漏りの痕跡。ルーフ周りとフロアの湿りを確認\n- 外装の割れや欠品。部品探しが難しい場合があります\n- 下回りの錆と、補修痕。保管環境が読めます",
      maintenance:
        "### 整備はできても、部品は別問題\n機関は軽の延長で対応できますが、外装や内装は状態勝負。購入前に欠品を洗い出し、許容できる範囲を決めておくと迷いが減ります。",
      used:
        "### 迷うなら買わない判断も強い\n希少車は『次がない』と言われがちですが、状態が悪い車を掴むと次も何もなくなります。惚れた上で、状態に納得できる個体だけを狙いたいです。",
    },
  },
  "lexus-lfa-2010": {
    summaryLong:
      "LFAは、国産スーパーカーの中でも別格の工芸品に近く、走りだけでなく『保管と維持』まで含めて楽しむ車種です。中古ではメーターの数字より、管理履歴とコンディションの一貫性がすべて。タイヤや油脂類の管理、バッテリー、保管環境の差がそのまま状態に出ます。専門拠点と付き合えるか、部品と作業のリードタイムを受け入れられるかも購入条件。整った個体は、音と回転の気持ち良さが強烈です。",
    add: {
      check:
        "### 管理状態を確認する質問\n- バッテリー管理と始動頻度。長期保管の扱い方を確認\n- タイヤの製造年と状態。距離が少なくても時間で劣化します\n- 油脂類の交換サイクル。走らせない車ほど劣化しやすい\n- 作業を任せている拠点。引き継げるかどうかが重要です",
      maintenance:
        "### 走らせる前に整える時間\n納車直後に全開で走るより、段階的に慣らして状態を確認する方が安全です。部品の手配も含めて、時間がコストになる車種です。",
      used:
        "### 個体差より『管理差』\n台数が少ないからこそ、管理の差がそのまま状態に出ます。走行距離の数字より、保管環境と履歴の一貫性を重視したいです。",
    },
  },
  "ferrari-f40": {
    summaryLong:
      "F40は、フェラーリの中でも扱いが難しいというより、扱い方を選ぶ車です。快適装備が少なく、乗り味も現代車の延長では語れません。中古で最優先なのは真贋や履歴の透明性、そして『保管と整備の系譜』。長期保管で弱る部品も多く、購入後にいきなり走らせるより、段階的にコンディションを整えるのが安全です。上手く維持できれば、スピード以上に生々しい体験が残ります。",
    add: {
      check:
        "### 真贋と履歴は最優先\n- シャシー番号と書類の整合性。曖昧な車は避ける\n- 過去の整備記録と保管履歴。誰が守ってきたかが重要\n- 外装の補修痕。事故だけでなく経年補修も含めて確認\n- 始動性と温度の上がり方。冷間からの癖を把握しておく",
      maintenance:
        "### 乗る頻度と整備のバランス\n乗らなすぎると劣化し、乗りすぎると消耗する。その中間を探す車です。タイヤや燃料系の管理など、維持の作法が満足度に直結します。",
      used:
        "### 安いF40は想像以上に高い\n整備で戻る範囲を超えている個体は、金額の問題だけではなく時間と精神力も消耗します。購入前に、信頼できるプロに同行してもらう価値があります。",
    },
  },
  "mercedes-benz-s-class-w140": {
    summaryLong:
      "W140 Sクラスは、当時のメルセデスが物量と技術を惜しみなく投入した、最後の重厚系ラグジュアリーの代表格です。中古で気を付けたいのは、機関そのものより電装・内装・快適装備のコンディション。小さな不具合が積み重なると、満足度が急に下がります。整備履歴が読めて、信頼できる工場に持ち込めるなら、現代車では得にくい静かさと厚みのある乗り味を手に入れられます。",
    add: {
      check:
        "### 快適装備の動作確認は必須\n- エアコンの効きと風量、温度調整の反応\n- パワーシートや窓、ミラーなど各モーター類\n- メーター警告灯の点灯履歴。消してある車は疑う\n- 試乗での変速ショックとブレーキの真っ直ぐさ",
      maintenance:
        "### 修理は『小さなうち』が安い\n放置すると別の部品を巻き込みやすいので、違和感が出たら早めに直す方が結果的に安いです。古い高級車はここが逆転しやすい。",
      used:
        "### 価格より『主治医』\n購入前に、持ち込める工場があるかを確認する。工場が決まれば、車の選び方も整備の進め方も一気に具体化します。",
    },
  },
};

const HEADINGS = {
  check: "買う前のチェック",
  maintenance: "維持費",
  used: "中古で買うなら",
};

function injectAtEndOfSection(body, headingTitle, extra) {
  if (!body || !extra) return body;
  const marker = `## ${headingTitle}\n`;
  const idx = body.indexOf(marker);
  if (idx === -1) return body;

  const start = idx + marker.length;
  const next = body.indexOf("\n## ", start);
  if (next === -1) {
    return `${body.trimEnd()}\n\n${extra.trim()}\n`;
  }

  return `${body.slice(0, next).trimEnd()}\n\n${extra.trim()}\n${body.slice(next)}`;
}

let changed = 0;
for (const [slug, patch] of Object.entries(updates)) {
  const file = path.join(carsDir, `${slug}.json`);
  if (!fs.existsSync(file)) {
    throw new Error(`Missing car json: ${slug}`);
  }

  const car = JSON.parse(fs.readFileSync(file, "utf8"));
  car.summaryLong = patch.summaryLong;

  let body = String(car.body || "");
  body = injectAtEndOfSection(body, HEADINGS.check, patch.add?.check || "");
  body = injectAtEndOfSection(body, HEADINGS.maintenance, patch.add?.maintenance || "");
  body = injectAtEndOfSection(body, HEADINGS.used, patch.add?.used || "");
  car.body = body;

  // Simple safety: no asterisk or ASCII double quote in body
  if (car.body.includes("*") || car.body.includes('"')) {
    throw new Error(`Banned char found in body: ${slug}`);
  }

  fs.writeFileSync(file, JSON.stringify(car, null, 2) + "\n", "utf8");
  changed += 1;
}

console.log(`car major overhaul v2 applied: ${changed}`);
